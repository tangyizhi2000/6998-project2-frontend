{"ast":null,"code":"import _slicedToArray from \"/Users/tangyizhi/Desktop/Assignment2/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useState, useRef } from 'react';\nimport InternalSelect from '../select/internal';\nimport InternalAutosuggest from '../autosuggest/internal';\nimport InternalPopover from '../popover/internal';\nimport styles from './styles.css.js';\nimport { useLoadItems } from './use-load-items';\nimport { createPropertiesCompatibilityMap, getAllowedOperators, operatorToDescription, getPropertySuggestions } from './controller';\nimport InternalButton from '../button/internal';\nimport InternalFormField from '../form-field/internal';\nimport { matchTokenValue } from './utils';\nvar freeTextOperators = [':', '!:'];\nfunction PropertyInput(_ref) {\n  var property = _ref.property,\n    onChangePropertyKey = _ref.onChangePropertyKey,\n    asyncProps = _ref.asyncProps,\n    filteringProperties = _ref.filteringProperties,\n    onLoadItems = _ref.onLoadItems,\n    customGroupsText = _ref.customGroupsText,\n    i18nStrings = _ref.i18nStrings,\n    disableFreeTextFiltering = _ref.disableFreeTextFiltering;\n  var _a;\n  var propertySelectHandlers = useLoadItems(onLoadItems);\n  var asyncPropertySelectProps = asyncProps ? Object.assign(Object.assign({}, asyncProps), propertySelectHandlers) : {};\n  var propertyOptions = getPropertySuggestions(filteringProperties, customGroupsText, i18nStrings, function (_ref2) {\n    var propertyKey = _ref2.propertyKey,\n      propertyLabel = _ref2.propertyLabel;\n    return {\n      value: propertyKey,\n      label: propertyLabel,\n      dontCloseOnSelect: true\n    };\n  });\n  // Disallow selecting properties that have different representation.\n  var checkPropertiesCompatible = createPropertiesCompatibilityMap(filteringProperties);\n  propertyOptions.forEach(function (optionGroup) {\n    if ('options' in optionGroup) {\n      optionGroup.options.forEach(function (option) {\n        if ((property === null || property === void 0 ? void 0 : property.propertyKey) && option.value) {\n          option.disabled = !checkPropertiesCompatible(option.value, property.propertyKey);\n        }\n      });\n    }\n  });\n  var allPropertiesOption = {\n    label: i18nStrings.allPropertiesLabel,\n    value: undefined\n  };\n  if (!disableFreeTextFiltering) {\n    propertyOptions.unshift(allPropertiesOption);\n  }\n  return React.createElement(InternalSelect, Object.assign({\n    options: propertyOptions,\n    selectedOption: property ? {\n      value: (_a = property.propertyKey) !== null && _a !== void 0 ? _a : undefined,\n      label: property.propertyLabel\n    } : allPropertiesOption,\n    onChange: function onChange(e) {\n      return onChangePropertyKey(e.detail.selectedOption.value);\n    }\n  }, asyncPropertySelectProps));\n}\nfunction OperatorInput(_ref3) {\n  var property = _ref3.property,\n    operator = _ref3.operator,\n    onChangeOperator = _ref3.onChangeOperator,\n    i18nStrings = _ref3.i18nStrings;\n  var freeTextOperators = [':', '!:'];\n  var operatorOptions = (property ? getAllowedOperators(property) : freeTextOperators).map(function (operator) {\n    return {\n      value: operator,\n      label: operator,\n      description: operatorToDescription(operator, i18nStrings)\n    };\n  });\n  return React.createElement(InternalSelect, {\n    options: operatorOptions,\n    triggerVariant: \"option\",\n    selectedOption: operator ? {\n      value: operator,\n      label: operator,\n      description: operatorToDescription(operator, i18nStrings)\n    } : null,\n    onChange: function onChange(e) {\n      return onChangeOperator(e.detail.selectedOption.value);\n    }\n  });\n}\nfunction ValueInput(_ref4) {\n  var property = _ref4.property,\n    operator = _ref4.operator,\n    value = _ref4.value,\n    onChangeValue = _ref4.onChangeValue,\n    asyncProps = _ref4.asyncProps,\n    filteringOptions = _ref4.filteringOptions,\n    onLoadItems = _ref4.onLoadItems,\n    i18nStrings = _ref4.i18nStrings;\n  var _a, _b, _c;\n  var valueOptions = property ? filteringOptions.filter(function (option) {\n    return option.property === property;\n  }).map(function (_ref5) {\n    var label = _ref5.label,\n      value = _ref5.value;\n    return {\n      label: label,\n      value: value\n    };\n  }) : [];\n  var valueAutosuggestHandlers = useLoadItems(onLoadItems, '', property === null || property === void 0 ? void 0 : property.externalProperty);\n  var asyncValueAutosuggestProps = (property === null || property === void 0 ? void 0 : property.propertyKey) ? Object.assign(Object.assign({}, valueAutosuggestHandlers), asyncProps) : {\n    empty: asyncProps.empty\n  };\n  var _valueOptions$filter = valueOptions.filter(function (option) {\n      return option.value === value;\n    }),\n    _valueOptions$filter2 = _slicedToArray(_valueOptions$filter, 1),\n    matchedOption = _valueOptions$filter2[0];\n  var OperatorForm = (property === null || property === void 0 ? void 0 : property.propertyKey) && operator && (property === null || property === void 0 ? void 0 : property.getValueFormRenderer(operator));\n  return OperatorForm ? React.createElement(OperatorForm, {\n    value: value,\n    onChange: onChangeValue,\n    operator: operator\n  }) : React.createElement(InternalAutosuggest, Object.assign({\n    enteredTextLabel: (_a = i18nStrings.enteredTextLabel) !== null && _a !== void 0 ? _a : function (value) {\n      return value;\n    },\n    value: (_c = (_b = matchedOption === null || matchedOption === void 0 ? void 0 : matchedOption.label) !== null && _b !== void 0 ? _b : value) !== null && _c !== void 0 ? _c : '',\n    clearAriaLabel: i18nStrings.clearAriaLabel,\n    onChange: function onChange(e) {\n      return onChangeValue(e.detail.value);\n    },\n    disabled: !operator,\n    options: valueOptions\n  }, asyncValueAutosuggestProps, {\n    virtualScroll: true\n  }));\n}\nexport function TokenEditor(_ref6) {\n  var asyncProperties = _ref6.asyncProperties,\n    asyncProps = _ref6.asyncProps,\n    customGroupsText = _ref6.customGroupsText,\n    disableFreeTextFiltering = _ref6.disableFreeTextFiltering,\n    expandToViewport = _ref6.expandToViewport,\n    filteringProperties = _ref6.filteringProperties,\n    filteringOptions = _ref6.filteringOptions,\n    i18nStrings = _ref6.i18nStrings,\n    onLoadItems = _ref6.onLoadItems,\n    setToken = _ref6.setToken,\n    token = _ref6.token,\n    triggerComponent = _ref6.triggerComponent;\n  var _useState = useState(token),\n    _useState2 = _slicedToArray(_useState, 2),\n    temporaryToken = _useState2[0],\n    setTemporaryToken = _useState2[1];\n  var popoverRef = useRef(null);\n  var closePopover = function closePopover() {\n    popoverRef.current && popoverRef.current.dismissPopover();\n  };\n  var property = temporaryToken.property;\n  var onChangePropertyKey = function onChangePropertyKey(newPropertyKey) {\n    var _a;\n    var filteringProperty = filteringProperties.reduce(function (acc, property) {\n      return property.propertyKey === newPropertyKey ? property : acc;\n    }, undefined);\n    var allowedOperators = filteringProperty ? getAllowedOperators(filteringProperty) : freeTextOperators;\n    var operator = temporaryToken.operator && allowedOperators.indexOf(temporaryToken.operator) !== -1 ? temporaryToken.operator : allowedOperators[0];\n    var matchedProperty = (_a = filteringProperties.find(function (property) {\n      return property.propertyKey === newPropertyKey;\n    })) !== null && _a !== void 0 ? _a : null;\n    setTemporaryToken(Object.assign(Object.assign({}, temporaryToken), {\n      property: matchedProperty,\n      operator: operator\n    }));\n  };\n  var operator = temporaryToken.operator;\n  var onChangeOperator = function onChangeOperator(newOperator) {\n    setTemporaryToken(Object.assign(Object.assign({}, temporaryToken), {\n      operator: newOperator\n    }));\n  };\n  var value = temporaryToken.value;\n  var onChangeValue = function onChangeValue(newValue) {\n    setTemporaryToken(Object.assign(Object.assign({}, temporaryToken), {\n      value: newValue\n    }));\n  };\n  return React.createElement(InternalPopover, {\n    ref: popoverRef,\n    className: styles['token-label'],\n    triggerType: \"text\",\n    header: i18nStrings.editTokenHeader,\n    size: \"large\",\n    position: \"right\",\n    dismissAriaLabel: i18nStrings.dismissAriaLabel,\n    __onOpen: function __onOpen() {\n      return setTemporaryToken(token);\n    },\n    renderWithPortal: expandToViewport,\n    content: React.createElement(\"div\", {\n      className: styles['token-editor']\n    }, React.createElement(\"div\", {\n      className: styles['token-editor-form']\n    }, React.createElement(InternalFormField, {\n      label: i18nStrings.propertyText,\n      className: styles['token-editor-field-property']\n    }, React.createElement(PropertyInput, {\n      property: property,\n      onChangePropertyKey: onChangePropertyKey,\n      asyncProps: asyncProperties ? asyncProps : null,\n      filteringProperties: filteringProperties,\n      onLoadItems: onLoadItems,\n      customGroupsText: customGroupsText,\n      i18nStrings: i18nStrings,\n      disableFreeTextFiltering: disableFreeTextFiltering\n    })), React.createElement(InternalFormField, {\n      label: i18nStrings.operatorText,\n      className: styles['token-editor-field-operator']\n    }, React.createElement(OperatorInput, {\n      property: property,\n      operator: operator,\n      onChangeOperator: onChangeOperator,\n      i18nStrings: i18nStrings\n    })), React.createElement(InternalFormField, {\n      label: i18nStrings.valueText,\n      className: styles['token-editor-field-value']\n    }, React.createElement(ValueInput, {\n      property: property,\n      operator: operator,\n      value: value,\n      onChangeValue: onChangeValue,\n      asyncProps: asyncProps,\n      filteringOptions: filteringOptions,\n      onLoadItems: onLoadItems,\n      i18nStrings: i18nStrings\n    }))), React.createElement(\"div\", {\n      className: styles['token-editor-actions']\n    }, React.createElement(InternalButton, {\n      formAction: \"none\",\n      variant: \"link\",\n      className: styles['token-editor-cancel'],\n      onClick: closePopover\n    }, i18nStrings.cancelActionText), React.createElement(InternalButton, {\n      className: styles['token-editor-submit'],\n      formAction: \"none\",\n      onClick: function onClick() {\n        setToken(matchTokenValue(temporaryToken, filteringOptions));\n        closePopover();\n      }\n    }, i18nStrings.applyActionText)))\n  }, triggerComponent);\n}","map":{"version":3,"mappings":"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","names":["React","useState","useRef","InternalSelect","InternalAutosuggest","InternalPopover","styles","useLoadItems","createPropertiesCompatibilityMap","getAllowedOperators","operatorToDescription","getPropertySuggestions","InternalButton","InternalFormField","matchTokenValue","freeTextOperators","PropertyInput","property","onChangePropertyKey","asyncProps","filteringProperties","onLoadItems","customGroupsText","i18nStrings","disableFreeTextFiltering","propertySelectHandlers","asyncPropertySelectProps","Object","propertyOptions","propertyKey","propertyLabel","value","label","dontCloseOnSelect","checkPropertiesCompatible","forEach","optionGroup","options","option","disabled","allPropertiesOption","allPropertiesLabel","undefined","unshift","selectedOption","onChange","e","detail","OperatorInput","operator","onChangeOperator","operatorOptions","map","description","triggerVariant","ValueInput","onChangeValue","filteringOptions","valueOptions","filter","valueAutosuggestHandlers","externalProperty","asyncValueAutosuggestProps","empty","matchedOption","OperatorForm","getValueFormRenderer","enteredTextLabel","clearAriaLabel","virtualScroll","TokenEditor","asyncProperties","expandToViewport","setToken","token","triggerComponent","temporaryToken","setTemporaryToken","popoverRef","closePopover","current","dismissPopover","newPropertyKey","filteringProperty","reduce","acc","allowedOperators","indexOf","matchedProperty","find","newOperator","newValue","ref","className","triggerType","header","editTokenHeader","size","position","dismissAriaLabel","__onOpen","renderWithPortal","content","propertyText","operatorText","valueText","formAction","variant","onClick","cancelActionText","applyActionText"],"sources":["/Users/tangyizhi/Desktop/Assignment2/frontend/node_modules/@cloudscape-design/components/property-filter/lib/default/property-filter/token-editor.tsx"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useState, useRef } from 'react';\n\nimport { SelectProps } from '../select/interfaces';\nimport InternalSelect from '../select/internal';\nimport InternalAutosuggest from '../autosuggest/internal';\nimport InternalPopover, { InternalPopoverRef } from '../popover/internal';\nimport {\n  ComparisonOperator,\n  GroupText,\n  I18nStrings,\n  InternalFilteringOption,\n  InternalFilteringProperty,\n  InternalToken,\n  LoadItemsDetail,\n  Token,\n} from './interfaces';\nimport styles from './styles.css.js';\nimport { useLoadItems } from './use-load-items';\nimport {\n  createPropertiesCompatibilityMap,\n  getAllowedOperators,\n  operatorToDescription,\n  getPropertySuggestions,\n} from './controller';\nimport { NonCancelableEventHandler } from '../internal/events';\nimport { DropdownStatusProps } from '../internal/components/dropdown-status/interfaces';\nimport InternalButton from '../button/internal';\nimport InternalFormField from '../form-field/internal';\nimport { matchTokenValue } from './utils';\n\nconst freeTextOperators: ComparisonOperator[] = [':', '!:'];\n\ninterface PropertyInputProps {\n  asyncProps: null | DropdownStatusProps;\n  customGroupsText: readonly GroupText[];\n  disableFreeTextFiltering?: boolean;\n  filteringProperties: readonly InternalFilteringProperty[];\n  i18nStrings: I18nStrings;\n  onChangePropertyKey: (propertyKey: undefined | string) => void;\n  onLoadItems?: NonCancelableEventHandler<LoadItemsDetail>;\n  property: null | InternalFilteringProperty;\n}\n\nfunction PropertyInput({\n  property,\n  onChangePropertyKey,\n  asyncProps,\n  filteringProperties,\n  onLoadItems,\n  customGroupsText,\n  i18nStrings,\n  disableFreeTextFiltering,\n}: PropertyInputProps) {\n  const propertySelectHandlers = useLoadItems(onLoadItems);\n  const asyncPropertySelectProps = asyncProps ? { ...asyncProps, ...propertySelectHandlers } : {};\n  const propertyOptions: (SelectProps.Option | SelectProps.OptionGroup)[] = getPropertySuggestions(\n    filteringProperties,\n    customGroupsText,\n    i18nStrings,\n    ({ propertyKey, propertyLabel }) => ({\n      value: propertyKey,\n      label: propertyLabel,\n      dontCloseOnSelect: true,\n    })\n  );\n\n  // Disallow selecting properties that have different representation.\n  const checkPropertiesCompatible = createPropertiesCompatibilityMap(filteringProperties);\n  propertyOptions.forEach(optionGroup => {\n    if ('options' in optionGroup) {\n      optionGroup.options.forEach(option => {\n        if (property?.propertyKey && option.value) {\n          option.disabled = !checkPropertiesCompatible(option.value, property.propertyKey);\n        }\n      });\n    }\n  });\n\n  const allPropertiesOption = {\n    label: i18nStrings.allPropertiesLabel,\n    value: undefined,\n  };\n  if (!disableFreeTextFiltering) {\n    propertyOptions.unshift(allPropertiesOption);\n  }\n  return (\n    <InternalSelect\n      options={propertyOptions}\n      selectedOption={\n        property\n          ? {\n              value: property.propertyKey ?? undefined,\n              label: property.propertyLabel,\n            }\n          : allPropertiesOption\n      }\n      onChange={e => onChangePropertyKey(e.detail.selectedOption.value)}\n      {...asyncPropertySelectProps}\n    />\n  );\n}\n\ninterface OperatorInputProps {\n  i18nStrings: I18nStrings;\n  onChangeOperator: (operator: ComparisonOperator) => void;\n  operator: undefined | ComparisonOperator;\n  property: null | InternalFilteringProperty;\n}\n\nfunction OperatorInput({ property, operator, onChangeOperator, i18nStrings }: OperatorInputProps) {\n  const freeTextOperators: ComparisonOperator[] = [':', '!:'];\n  const operatorOptions = (property ? getAllowedOperators(property) : freeTextOperators).map(operator => ({\n    value: operator,\n    label: operator,\n    description: operatorToDescription(operator, i18nStrings),\n  }));\n  return (\n    <InternalSelect\n      options={operatorOptions}\n      triggerVariant=\"option\"\n      selectedOption={\n        operator\n          ? {\n              value: operator,\n              label: operator,\n              description: operatorToDescription(operator, i18nStrings),\n            }\n          : null\n      }\n      onChange={e => onChangeOperator(e.detail.selectedOption.value as ComparisonOperator)}\n    />\n  );\n}\n\ninterface ValueInputProps {\n  asyncProps: DropdownStatusProps;\n  filteringOptions: readonly InternalFilteringOption[];\n  i18nStrings: I18nStrings;\n  onChangeValue: (value: string) => void;\n  onLoadItems?: NonCancelableEventHandler<LoadItemsDetail>;\n  operator: undefined | ComparisonOperator;\n  property: null | InternalFilteringProperty;\n  value: undefined | string;\n}\n\nfunction ValueInput({\n  property,\n  operator,\n  value,\n  onChangeValue,\n  asyncProps,\n  filteringOptions,\n  onLoadItems,\n  i18nStrings,\n}: ValueInputProps) {\n  const valueOptions = property\n    ? filteringOptions\n        .filter(option => option.property === property)\n        .map(({ label, value }) => ({\n          label,\n          value,\n        }))\n    : [];\n  const valueAutosuggestHandlers = useLoadItems(onLoadItems, '', property?.externalProperty);\n  const asyncValueAutosuggestProps = property?.propertyKey\n    ? { ...valueAutosuggestHandlers, ...asyncProps }\n    : { empty: asyncProps.empty };\n  const [matchedOption] = valueOptions.filter(option => option.value === value);\n\n  const OperatorForm = property?.propertyKey && operator && property?.getValueFormRenderer(operator);\n\n  return OperatorForm ? (\n    <OperatorForm value={value} onChange={onChangeValue} operator={operator} />\n  ) : (\n    <InternalAutosuggest\n      enteredTextLabel={i18nStrings.enteredTextLabel ?? (value => value)}\n      value={matchedOption?.label ?? value ?? ''}\n      clearAriaLabel={i18nStrings.clearAriaLabel}\n      onChange={e => onChangeValue(e.detail.value)}\n      disabled={!operator}\n      options={valueOptions}\n      {...asyncValueAutosuggestProps}\n      virtualScroll={true}\n    />\n  );\n}\n\ninterface TokenEditorProps {\n  asyncProperties?: boolean;\n  asyncProps: DropdownStatusProps;\n  customGroupsText: readonly GroupText[];\n  disabled?: boolean;\n  disableFreeTextFiltering?: boolean;\n  expandToViewport?: boolean;\n  filteringProperties: readonly InternalFilteringProperty[];\n  filteringOptions: readonly InternalFilteringOption[];\n  i18nStrings: I18nStrings;\n  onLoadItems?: NonCancelableEventHandler<LoadItemsDetail>;\n  setToken: (newToken: Token) => void;\n  token: InternalToken;\n  triggerComponent?: React.ReactNode;\n}\n\nexport function TokenEditor({\n  asyncProperties,\n  asyncProps,\n  customGroupsText,\n  disableFreeTextFiltering,\n  expandToViewport,\n  filteringProperties,\n  filteringOptions,\n  i18nStrings,\n  onLoadItems,\n  setToken,\n  token,\n  triggerComponent,\n}: TokenEditorProps) {\n  const [temporaryToken, setTemporaryToken] = useState<InternalToken>(token);\n  const popoverRef = useRef<InternalPopoverRef>(null);\n  const closePopover = () => {\n    popoverRef.current && popoverRef.current.dismissPopover();\n  };\n\n  const property = temporaryToken.property;\n  const onChangePropertyKey = (newPropertyKey: undefined | string) => {\n    const filteringProperty = filteringProperties.reduce<InternalFilteringProperty | undefined>(\n      (acc, property) => (property.propertyKey === newPropertyKey ? property : acc),\n      undefined\n    );\n    const allowedOperators = filteringProperty ? getAllowedOperators(filteringProperty) : freeTextOperators;\n    const operator =\n      temporaryToken.operator && allowedOperators.indexOf(temporaryToken.operator) !== -1\n        ? temporaryToken.operator\n        : allowedOperators[0];\n    const matchedProperty = filteringProperties.find(property => property.propertyKey === newPropertyKey) ?? null;\n    setTemporaryToken({ ...temporaryToken, property: matchedProperty, operator });\n  };\n\n  const operator = temporaryToken.operator;\n  const onChangeOperator = (newOperator: ComparisonOperator) => {\n    setTemporaryToken({ ...temporaryToken, operator: newOperator });\n  };\n\n  const value = temporaryToken.value;\n  const onChangeValue = (newValue: string) => {\n    setTemporaryToken({ ...temporaryToken, value: newValue });\n  };\n\n  return (\n    <InternalPopover\n      ref={popoverRef}\n      className={styles['token-label']}\n      triggerType=\"text\"\n      header={i18nStrings.editTokenHeader}\n      size=\"large\"\n      position=\"right\"\n      dismissAriaLabel={i18nStrings.dismissAriaLabel}\n      __onOpen={() => setTemporaryToken(token)}\n      renderWithPortal={expandToViewport}\n      content={\n        <div className={styles['token-editor']}>\n          <div className={styles['token-editor-form']}>\n            <InternalFormField label={i18nStrings.propertyText} className={styles['token-editor-field-property']}>\n              <PropertyInput\n                property={property}\n                onChangePropertyKey={onChangePropertyKey}\n                asyncProps={asyncProperties ? asyncProps : null}\n                filteringProperties={filteringProperties}\n                onLoadItems={onLoadItems}\n                customGroupsText={customGroupsText}\n                i18nStrings={i18nStrings}\n                disableFreeTextFiltering={disableFreeTextFiltering}\n              />\n            </InternalFormField>\n\n            <InternalFormField label={i18nStrings.operatorText} className={styles['token-editor-field-operator']}>\n              <OperatorInput\n                property={property}\n                operator={operator}\n                onChangeOperator={onChangeOperator}\n                i18nStrings={i18nStrings}\n              />\n            </InternalFormField>\n\n            <InternalFormField label={i18nStrings.valueText} className={styles['token-editor-field-value']}>\n              <ValueInput\n                property={property}\n                operator={operator}\n                value={value}\n                onChangeValue={onChangeValue}\n                asyncProps={asyncProps}\n                filteringOptions={filteringOptions}\n                onLoadItems={onLoadItems}\n                i18nStrings={i18nStrings}\n              />\n            </InternalFormField>\n          </div>\n\n          <div className={styles['token-editor-actions']}>\n            <InternalButton\n              formAction=\"none\"\n              variant=\"link\"\n              className={styles['token-editor-cancel']}\n              onClick={closePopover}\n            >\n              {i18nStrings.cancelActionText}\n            </InternalButton>\n            <InternalButton\n              className={styles['token-editor-submit']}\n              formAction=\"none\"\n              onClick={() => {\n                setToken(matchTokenValue(temporaryToken, filteringOptions));\n                closePopover();\n              }}\n            >\n              {i18nStrings.applyActionText}\n            </InternalButton>\n          </div>\n        </div>\n      }\n    >\n      {triggerComponent}\n    </InternalPopover>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}