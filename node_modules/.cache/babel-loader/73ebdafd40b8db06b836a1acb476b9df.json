{"ast":null,"code":"import _slicedToArray from \"/Users/tangyizhi/Desktop/Assignment2/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\n// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useState } from 'react';\nimport { makeCancellable, PromiseCancelledSignal } from '../../internal/utils/promises';\nimport { extractBucketName, validate } from './validation';\nimport { useStableCallback } from '@cloudscape-design/component-toolkit/internal';\nexport function useVersionsFetch(fetchVersions) {\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    loading = _useState2[0],\n    setLoading = _useState2[1];\n  var _useState3 = useState(''),\n    _useState4 = _slicedToArray(_useState3, 2),\n    lastFetchedValue = _useState4[0],\n    setLastFetched = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    versions = _useState6[0],\n    setVersions = _useState6[1];\n  var loadVersions = function loadVersions(uri) {\n    if (uri === lastFetchedValue) {\n      return;\n    }\n    setLastFetched(uri);\n    var errorCode = validate(uri);\n    var _extractBucketName = extractBucketName(uri),\n      _extractBucketName2 = _slicedToArray(_extractBucketName, 2),\n      bucketName = _extractBucketName2[0],\n      prefix = _extractBucketName2[1];\n    if (errorCode || !bucketName || !prefix || prefix.slice(-1) === '/') {\n      return;\n    }\n    setLoading(true);\n    var result = makeCancellable(fetchVersions(bucketName, prefix));\n    result.promise.then(function (versions) {\n      setLoading(false);\n      setVersions(versions.map(function (version) {\n        return {\n          value: version.VersionId,\n          label: version.LastModified\n        };\n      }));\n    }, function (err) {\n      if (!(err instanceof PromiseCancelledSignal)) {\n        setLoading(false);\n      }\n    });\n    return result;\n  };\n  return {\n    loading: loading,\n    versions: versions,\n    resetVersions: function resetVersions() {\n      return setVersions([]);\n    },\n    // this function is a dependency of useEffect\n    loadVersions: useStableCallback(loadVersions)\n  };\n}","map":{"version":3,"mappings":";AAAA;AACA;AACA,SAASA,QAAQ,QAAQ,OAAO;AAChC,SAASC,eAAe,EAAEC,sBAAsB,QAAQ,+BAA+B;AAEvF,SAASC,iBAAiB,EAAEC,QAAQ,QAAQ,cAAc;AAE1D,SAASC,iBAAiB,QAAQ,+CAA+C;AAEjF,OAAM,SAAUC,gBAAgB,CAACC,aAAuD;EACtF,gBAA8BP,QAAQ,CAAC,KAAK,CAAC;IAAA;IAAtCQ,OAAO;IAAEC,UAAU;EAC1B,iBAA2CT,QAAQ,CAAC,EAAE,CAAC;IAAA;IAAhDU,gBAAgB;IAAEC,cAAc;EACvC,iBAAgCX,QAAQ,CAA4B,EAAE,CAAC;IAAA;IAAhEY,QAAQ;IAAEC,WAAW;EAE5B,IAAMC,YAAY,GAAG,SAAfA,YAAY,CAAIC,GAAW,EAAI;IACnC,IAAIA,GAAG,KAAKL,gBAAgB,EAAE;MAC5B;;IAEFC,cAAc,CAACI,GAAG,CAAC;IACnB,IAAMC,SAAS,GAAGZ,QAAQ,CAACW,GAAG,CAAC;IAC/B,yBAA6BZ,iBAAiB,CAACY,GAAG,CAAC;MAAA;MAA5CE,UAAU;MAAEC,MAAM;IACzB,IAAIF,SAAS,IAAI,CAACC,UAAU,IAAI,CAACC,MAAM,IAAIA,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;MACnE;;IAEFV,UAAU,CAAC,IAAI,CAAC;IAChB,IAAMW,MAAM,GAAGnB,eAAe,CAACM,aAAa,CAACU,UAAU,EAAEC,MAAM,CAAC,CAAC;IACjEE,MAAM,CAACC,OAAO,CAACC,IAAI,CACjB,kBAAQ,EAAG;MACTb,UAAU,CAAC,KAAK,CAAC;MACjBI,WAAW,CACTD,QAAQ,CAACW,GAAG,CAAC,iBAAO;QAAA,OAAK;UACvBC,KAAK,EAAEC,OAAO,CAACC,SAAS;UACxBC,KAAK,EAAEF,OAAO,CAACG;SAChB;MAAA,CAAC,CAAC,CACJ;IACH,CAAC,EACD,aAAG,EAAG;MACJ,IAAI,EAAEC,GAAG,YAAY3B,sBAAsB,CAAC,EAAE;QAC5CO,UAAU,CAAC,KAAK,CAAC;;IAErB,CAAC,CACF;IACD,OAAOW,MAAM;EACf,CAAC;EAED,OAAO;IACLZ,OAAO,EAAPA,OAAO;IACPI,QAAQ,EAARA,QAAQ;IACRkB,aAAa,EAAE;MAAA,OAAMjB,WAAW,CAAC,EAAE,CAAC;IAAA;IACpC;IACAC,YAAY,EAAET,iBAAiB,CAACS,YAAY;GAC7C;AACH","names":["useState","makeCancellable","PromiseCancelledSignal","extractBucketName","validate","useStableCallback","useVersionsFetch","fetchVersions","loading","setLoading","lastFetchedValue","setLastFetched","versions","setVersions","loadVersions","uri","errorCode","bucketName","prefix","slice","result","promise","then","map","value","version","VersionId","label","LastModified","err","resetVersions"],"sources":["/Users/tangyizhi/Desktop/Assignment2/frontend/node_modules/@cloudscape-design/components/s3-resource-selector/s3-in-context/lib/default/s3-resource-selector/s3-in-context/use-versions-fetch.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useState } from 'react';\nimport { makeCancellable, PromiseCancelledSignal } from '../../internal/utils/promises';\nimport { SelectProps } from '../../select/interfaces';\nimport { extractBucketName, validate } from './validation';\nimport { S3ResourceSelectorProps } from '../interfaces';\nimport { useStableCallback } from '@cloudscape-design/component-toolkit/internal';\n\nexport function useVersionsFetch(fetchVersions: S3ResourceSelectorProps['fetchVersions']) {\n  const [loading, setLoading] = useState(false);\n  const [lastFetchedValue, setLastFetched] = useState('');\n  const [versions, setVersions] = useState<Array<SelectProps.Option>>([]);\n\n  const loadVersions = (uri: string) => {\n    if (uri === lastFetchedValue) {\n      return;\n    }\n    setLastFetched(uri);\n    const errorCode = validate(uri);\n    const [bucketName, prefix] = extractBucketName(uri);\n    if (errorCode || !bucketName || !prefix || prefix.slice(-1) === '/') {\n      return;\n    }\n    setLoading(true);\n    const result = makeCancellable(fetchVersions(bucketName, prefix));\n    result.promise.then(\n      versions => {\n        setLoading(false);\n        setVersions(\n          versions.map(version => ({\n            value: version.VersionId,\n            label: version.LastModified,\n          }))\n        );\n      },\n      err => {\n        if (!(err instanceof PromiseCancelledSignal)) {\n          setLoading(false);\n        }\n      }\n    );\n    return result;\n  };\n\n  return {\n    loading,\n    versions,\n    resetVersions: () => setVersions([]),\n    // this function is a dependency of useEffect\n    loadVersions: useStableCallback(loadVersions),\n  };\n}\n"]},"metadata":{},"sourceType":"module"}