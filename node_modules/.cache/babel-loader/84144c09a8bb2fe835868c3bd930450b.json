{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useRef, useState } from 'react';\nimport { useStableCallback } from '@cloudscape-design/component-toolkit/internal';\nimport { useControllable } from '../../internal/hooks/use-controllable';\nimport { fireNonCancelableEvent } from '../../internal/events';\nimport { awsuiPluginsInternal } from '../../internal/plugins/api';\nimport { sortByPriority } from '../../internal/plugins/helpers/utils';\nimport { convertRuntimeDrawers } from '../runtime-api';\nimport { togglesConfig } from '../toggles';\nexport const TOOLS_DRAWER_ID = 'awsui-internal-tools';\nfunction getToolsDrawerItem(props) {\n  if (props.toolsHide) {\n    return null;\n  }\n  const {\n    iconName,\n    getLabels\n  } = togglesConfig.tools;\n  const {\n    mainLabel,\n    closeLabel,\n    openLabel\n  } = getLabels(props.ariaLabels);\n  return {\n    id: TOOLS_DRAWER_ID,\n    content: props.tools,\n    resizable: false,\n    ariaLabels: {\n      triggerButton: openLabel,\n      closeButton: closeLabel,\n      content: mainLabel\n    },\n    trigger: {\n      iconName: iconName\n    }\n  };\n}\nfunction useRuntimeDrawers(disableRuntimeDrawers, activeDrawerId, onActiveDrawerChange) {\n  const [runtimeDrawers, setRuntimeDrawers] = useState({\n    before: [],\n    after: []\n  });\n  const onActiveDrawerChangeStable = useStableCallback(onActiveDrawerChange);\n  const drawerWasOpenRef = useRef(false);\n  drawerWasOpenRef.current = drawerWasOpenRef.current || !!activeDrawerId;\n  useEffect(() => {\n    if (disableRuntimeDrawers) {\n      return;\n    }\n    const unsubscribe = awsuiPluginsInternal.appLayout.onDrawersRegistered(drawers => {\n      setRuntimeDrawers(convertRuntimeDrawers(drawers));\n      if (!drawerWasOpenRef.current) {\n        const defaultActiveDrawer = sortByPriority(drawers).find(drawer => drawer.defaultActive);\n        if (defaultActiveDrawer) {\n          onActiveDrawerChangeStable(defaultActiveDrawer.id);\n        }\n      }\n    });\n    return () => {\n      unsubscribe();\n      setRuntimeDrawers({\n        before: [],\n        after: []\n      });\n    };\n  }, [disableRuntimeDrawers, onActiveDrawerChangeStable]);\n  return runtimeDrawers;\n}\nfunction applyToolsDrawer(toolsProps, runtimeDrawers) {\n  const drawers = [...runtimeDrawers.before, ...runtimeDrawers.after];\n  if (drawers.length === 0) {\n    return null;\n  }\n  const toolsItem = getToolsDrawerItem(toolsProps);\n  if (toolsItem) {\n    drawers.unshift(toolsItem);\n  }\n  return drawers;\n}\nexport function useDrawers(_ref, toolsProps) {\n  let {\n    drawers: ownDrawers,\n    __disableRuntimeDrawers: disableRuntimeDrawers\n  } = _ref;\n  var _a, _b;\n  const [activeDrawerId, setActiveDrawerId] = useControllable(ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.activeDrawerId, ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.onChange, undefined, {\n    componentName: 'AppLayout',\n    controlledProp: 'activeDrawerId',\n    changeHandler: 'onChange'\n  });\n  const [drawerSizes, setDrawerSizes] = useState({});\n  function onActiveDrawerResize(_ref2) {\n    let {\n      id,\n      size\n    } = _ref2;\n    setDrawerSizes(oldSizes => Object.assign(Object.assign({}, oldSizes), {\n      [id]: size\n    }));\n    fireNonCancelableEvent(activeDrawer === null || activeDrawer === void 0 ? void 0 : activeDrawer.onResize, {\n      id,\n      size\n    });\n    fireNonCancelableEvent(ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.onResize, {\n      id,\n      size\n    });\n  }\n  function onActiveDrawerChange(newDrawerId) {\n    setActiveDrawerId(newDrawerId);\n    if (hasOwnDrawers) {\n      fireNonCancelableEvent(ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.onChange, newDrawerId);\n    } else if (!toolsProps.toolsHide) {\n      toolsProps.onToolsToggle(newDrawerId === TOOLS_DRAWER_ID);\n    }\n  }\n  const hasOwnDrawers = !!(ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.items);\n  const runtimeDrawers = useRuntimeDrawers(disableRuntimeDrawers, activeDrawerId, onActiveDrawerChange);\n  const combinedDrawers = hasOwnDrawers ? [...runtimeDrawers.before, ...ownDrawers.items, ...runtimeDrawers.after] : applyToolsDrawer(toolsProps, runtimeDrawers);\n  // support toolsOpen in runtime-drawers-only mode\n  let activeDrawerIdResolved = toolsProps.toolsOpen && !hasOwnDrawers ? TOOLS_DRAWER_ID : activeDrawerId;\n  const activeDrawer = combinedDrawers === null || combinedDrawers === void 0 ? void 0 : combinedDrawers.find(drawer => drawer.id === activeDrawerIdResolved);\n  // ensure that id is only defined when the drawer exists\n  activeDrawerIdResolved = activeDrawer === null || activeDrawer === void 0 ? void 0 : activeDrawer.id;\n  return {\n    ariaLabel: ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.ariaLabel,\n    overflowAriaLabel: ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.overflowAriaLabel,\n    overflowWithBadgeAriaLabel: ownDrawers === null || ownDrawers === void 0 ? void 0 : ownDrawers.overflowWithBadgeAriaLabel,\n    drawers: combinedDrawers,\n    activeDrawer,\n    activeDrawerId: activeDrawerIdResolved,\n    activeDrawerSize: activeDrawerIdResolved ? (_b = (_a = drawerSizes[activeDrawerIdResolved]) !== null && _a !== void 0 ? _a : activeDrawer === null || activeDrawer === void 0 ? void 0 : activeDrawer.defaultSize) !== null && _b !== void 0 ? _b : toolsProps.toolsWidth : toolsProps.toolsWidth,\n    onActiveDrawerChange,\n    onActiveDrawerResize\n  };\n}","map":{"version":3,"mappings":"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","names":["useEffect","useRef","useState","useStableCallback","useControllable","fireNonCancelableEvent","awsuiPluginsInternal","sortByPriority","convertRuntimeDrawers","togglesConfig","TOOLS_DRAWER_ID","getToolsDrawerItem","props","toolsHide","iconName","getLabels","tools","mainLabel","closeLabel","openLabel","ariaLabels","id","content","resizable","triggerButton","closeButton","trigger","useRuntimeDrawers","disableRuntimeDrawers","activeDrawerId","onActiveDrawerChange","runtimeDrawers","setRuntimeDrawers","before","after","onActiveDrawerChangeStable","drawerWasOpenRef","current","unsubscribe","appLayout","onDrawersRegistered","drawers","defaultActiveDrawer","find","drawer","defaultActive","applyToolsDrawer","toolsProps","length","toolsItem","unshift","useDrawers","ownDrawers","__disableRuntimeDrawers","setActiveDrawerId","onChange","undefined","componentName","controlledProp","changeHandler","drawerSizes","setDrawerSizes","onActiveDrawerResize","size","oldSizes","Object","activeDrawer","onResize","newDrawerId","hasOwnDrawers","onToolsToggle","items","combinedDrawers","activeDrawerIdResolved","toolsOpen","ariaLabel","overflowAriaLabel","overflowWithBadgeAriaLabel","activeDrawerSize","defaultSize","toolsWidth"],"sources":["/Users/tangyizhi/Desktop/Assignment2/frontend/node_modules/@cloudscape-design/components/app-layout/utils/lib/default/app-layout/utils/use-drawers.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useStableCallback } from '@cloudscape-design/component-toolkit/internal';\nimport { DrawerItem, InternalDrawerProps } from '../drawer/interfaces';\nimport { useControllable } from '../../internal/hooks/use-controllable';\nimport { fireNonCancelableEvent } from '../../internal/events';\nimport { awsuiPluginsInternal } from '../../internal/plugins/api';\nimport { sortByPriority } from '../../internal/plugins/helpers/utils';\nimport { convertRuntimeDrawers, DrawersLayout } from '../runtime-api';\nimport { AppLayoutProps } from '../interfaces';\nimport { togglesConfig } from '../toggles';\n\nexport const TOOLS_DRAWER_ID = 'awsui-internal-tools';\n\ninterface ToolsProps {\n  toolsHide: boolean | undefined;\n  toolsOpen: boolean | undefined;\n  toolsWidth: number;\n  tools: React.ReactNode | undefined;\n  onToolsToggle: (newOpen: boolean) => void;\n  ariaLabels: AppLayoutProps.Labels | undefined;\n}\n\ntype DrawerChangeHandler = (newDrawerId: string | undefined) => void;\n\nfunction getToolsDrawerItem(props: ToolsProps): DrawerItem | null {\n  if (props.toolsHide) {\n    return null;\n  }\n  const { iconName, getLabels } = togglesConfig.tools;\n  const { mainLabel, closeLabel, openLabel } = getLabels(props.ariaLabels);\n  return {\n    id: TOOLS_DRAWER_ID,\n    content: props.tools,\n    resizable: false,\n    ariaLabels: {\n      triggerButton: openLabel,\n      closeButton: closeLabel,\n      content: mainLabel,\n    },\n    trigger: {\n      iconName: iconName,\n    },\n  };\n}\n\nfunction useRuntimeDrawers(\n  disableRuntimeDrawers: boolean | undefined,\n  activeDrawerId: string | undefined,\n  onActiveDrawerChange: DrawerChangeHandler\n) {\n  const [runtimeDrawers, setRuntimeDrawers] = useState<DrawersLayout>({ before: [], after: [] });\n  const onActiveDrawerChangeStable = useStableCallback(onActiveDrawerChange);\n\n  const drawerWasOpenRef = useRef(false);\n  drawerWasOpenRef.current = drawerWasOpenRef.current || !!activeDrawerId;\n\n  useEffect(() => {\n    if (disableRuntimeDrawers) {\n      return;\n    }\n    const unsubscribe = awsuiPluginsInternal.appLayout.onDrawersRegistered(drawers => {\n      setRuntimeDrawers(convertRuntimeDrawers(drawers));\n      if (!drawerWasOpenRef.current) {\n        const defaultActiveDrawer = sortByPriority(drawers).find(drawer => drawer.defaultActive);\n        if (defaultActiveDrawer) {\n          onActiveDrawerChangeStable(defaultActiveDrawer.id);\n        }\n      }\n    });\n    return () => {\n      unsubscribe();\n      setRuntimeDrawers({ before: [], after: [] });\n    };\n  }, [disableRuntimeDrawers, onActiveDrawerChangeStable]);\n\n  return runtimeDrawers;\n}\n\nfunction applyToolsDrawer(toolsProps: ToolsProps, runtimeDrawers: DrawersLayout) {\n  const drawers = [...runtimeDrawers.before, ...runtimeDrawers.after];\n  if (drawers.length === 0) {\n    return null;\n  }\n  const toolsItem = getToolsDrawerItem(toolsProps);\n  if (toolsItem) {\n    drawers.unshift(toolsItem);\n  }\n\n  return drawers;\n}\n\nexport function useDrawers(\n  {\n    drawers: ownDrawers,\n    __disableRuntimeDrawers: disableRuntimeDrawers,\n  }: InternalDrawerProps & { __disableRuntimeDrawers?: boolean },\n  toolsProps: ToolsProps\n) {\n  const [activeDrawerId, setActiveDrawerId] = useControllable(\n    ownDrawers?.activeDrawerId,\n    ownDrawers?.onChange,\n    undefined,\n    {\n      componentName: 'AppLayout',\n      controlledProp: 'activeDrawerId',\n      changeHandler: 'onChange',\n    }\n  );\n  const [drawerSizes, setDrawerSizes] = useState<Record<string, number>>({});\n\n  function onActiveDrawerResize({ id, size }: { id: string; size: number }) {\n    setDrawerSizes(oldSizes => ({ ...oldSizes, [id]: size }));\n    fireNonCancelableEvent(activeDrawer?.onResize, { id, size });\n    fireNonCancelableEvent(ownDrawers?.onResize, { id, size });\n  }\n\n  function onActiveDrawerChange(newDrawerId: string | undefined) {\n    setActiveDrawerId(newDrawerId);\n    if (hasOwnDrawers) {\n      fireNonCancelableEvent(ownDrawers?.onChange, newDrawerId);\n    } else if (!toolsProps.toolsHide) {\n      toolsProps.onToolsToggle(newDrawerId === TOOLS_DRAWER_ID);\n    }\n  }\n\n  const hasOwnDrawers = !!ownDrawers?.items;\n  const runtimeDrawers = useRuntimeDrawers(disableRuntimeDrawers, activeDrawerId, onActiveDrawerChange);\n  const combinedDrawers = hasOwnDrawers\n    ? [...runtimeDrawers.before, ...ownDrawers.items, ...runtimeDrawers.after]\n    : applyToolsDrawer(toolsProps, runtimeDrawers);\n  // support toolsOpen in runtime-drawers-only mode\n  let activeDrawerIdResolved = toolsProps.toolsOpen && !hasOwnDrawers ? TOOLS_DRAWER_ID : activeDrawerId;\n  const activeDrawer = combinedDrawers?.find(drawer => drawer.id === activeDrawerIdResolved);\n  // ensure that id is only defined when the drawer exists\n  activeDrawerIdResolved = activeDrawer?.id;\n\n  return {\n    ariaLabel: ownDrawers?.ariaLabel,\n    overflowAriaLabel: ownDrawers?.overflowAriaLabel,\n    overflowWithBadgeAriaLabel: ownDrawers?.overflowWithBadgeAriaLabel,\n    drawers: combinedDrawers,\n    activeDrawer,\n    activeDrawerId: activeDrawerIdResolved,\n    activeDrawerSize: activeDrawerIdResolved\n      ? drawerSizes[activeDrawerIdResolved] ?? activeDrawer?.defaultSize ?? toolsProps.toolsWidth\n      : toolsProps.toolsWidth,\n    onActiveDrawerChange,\n    onActiveDrawerResize,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}